type: grid
cards:
  - type: markdown
    content: ' '
    title: 'Pool filtration scheduling :'
  - type: entities
    entities:
      - entity: input_boolean.manual_filtration
    show_header_toggle: false
  - type: conditional
    conditions:
      - entity: input_boolean.manual_filtration
        state: 'on'
    card:
      type: vertical-stack
      cards:
        - type: entities
          entities:
            - entity: input_datetime.pump_manual_start
            - entity: input_number.manual_duration
          show_header_toggle: false
        - type: markdown
          content: >-
            **Last manual filtration started at :**

            {{
            (as_timestamp(states.automation.pool_manual_filtration_cycle_start.attributes.last_triggered))
            | timestamp_custom('%B %-d, %H:%M', True) }}


            {% if as_timestamp((states('input_datetime.pump_manual_stop')),0) >
            as_timestamp(now()) %}
              **end of filtration manual filtration planned at :**
            {{ (as_timestamp(states('input_datetime.pump_manual_stop'))) |
            timestamp_custom('%B %-d, %H:%M', True) }}

            {% else %}
              *Manual stop Not set*
            {% endif %}
  - type: entities
    entities:
      - entity: input_boolean.auto_filtration
    show_header_toggle: false
  - type: conditional
    conditions:
      - entity: input_boolean.auto_filtration
        state: 'on'
    card:
      type: vertical-stack
      cards:
        - type: entities
          entities:
            - entity: input_datetime.pump_auto_start
            - entity: sensor.auto_cycle_duration
            - entity: sensor.pompe_piscine_on_today
          show_header_toggle: false
        - type: markdown
          content: >+

            {% if
            states.automation.pool_auto_filtration_cycle_start.attributes.last_triggered
            == None %}

            None

            {% else %}

            **Last auto filtration started at :**

            {{
            (as_timestamp(states.automation.pool_auto_filtration_cycle_start.attributes.last_triggered))
            | timestamp_custom('%A, %B %-d, %H:%M', True) }}

            {% endif %}

          title: 'Auto filtration status :'
  - type: history-graph
    entities:
      - entity: switch.tz3000_pompe_piscine
    hours_to_show: 24
    refresh_interval: 0
    title: Pompe piscine
  - type: entities
    entities:
      - entity: sensor.pool_water_temp_avg
      - entity: switch.tz3000_pompe_piscine
    state_color: false
square: false
columns: 1
